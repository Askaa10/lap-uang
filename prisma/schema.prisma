generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String          @id @default(uuid())
  username      String          @unique
  password      String // hashed password
  email         String          @unique
  role          Role            @default(ADMIN)
  name          String?
  refresh_token String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  ResetPassword ResetPassword[]
}

model ResetPassword {
  id        String   @id @default(uuid()) // ID unik untuk resetPassword
  userId    String // Foreign key ke tabel User
  token     String // Token reset
  createdAt DateTime @default(now()) // Tanggal dibuat
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum Role {
  ADMIN
  STAFF
  USER
  VIEWER
}

model SchoolProfile {
  id           String   @id @default(uuid())
  name         String // Nama sekolah
  foundation   String
  address      String?
  phone        String?
  headmaster   String?
  academicYear String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

enum Major {
  RPL
  TKJ
}

model Student {
  id          String    @id @default(uuid())
  studentId   String    @unique
  name        String
  regisNumber String
  dorm        String?
  generation  Int
  major       Major
  sppTariff   Int
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  payments    Payment[]
  arrears     Arrear[]
}

model Payment {
  id        String   @id @default(uuid())
  studentId String
  student   Student  @relation(fields: [studentId], references: [id])
  date      DateTime
  amount    Int
  method    String?
  month     Int?
  year      Int?
  receipt   Receipt?
  createdAt DateTime @default(now())
}

model Receipt {
  id        String   @id @default(uuid())
  paymentId String   @unique
  payment   Payment  @relation(fields: [paymentId], references: [id])
  printedAt DateTime @default(now())
  printedBy String
}

model Arrear {
  id        String   @id @default(uuid())
  studentId String
  student   Student  @relation(fields: [studentId], references: [id])
  month     Int
  year      Int
  amount    Int
  resolved  Boolean  @default(false)
  createdAt DateTime @default(now())
}

model ExpenseCategory {
  id       String    @id @default(uuid())
  name     String    @unique
  budget   Int
  expenses Expense[]
}

model Expense {
  id          String          @id @default(uuid())
  categoryId  String
  category    ExpenseCategory @relation(fields: [categoryId], references: [id])
  date        DateTime
  amount      Int
  description String
  createdAt   DateTime        @default(now())
}

model InitialBalance {
  id          String   @id @default(uuid())
  description String
  amount      Int
  year        Int
  createdAt   DateTime @default(now())
}
